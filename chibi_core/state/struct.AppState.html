<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `AppState` struct in crate `chibi_core`."><title>AppState in chibi_core::state - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2"href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../static.files/rustdoc-ca0dd0c4.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="chibi_core" data-themes="" data-resource-suffix="" data-rustdoc-version="1.93.1 (01f6ddf75 2026-02-11)" data-channel="1.93.1" data-search-js="search-9e2438ea.js" data-stringdex-js="stringdex-a3946164.js" data-settings-js="settings-c38705f0.js" ><script src="../../static.files/storage-e2aeef58.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-a410ff4d.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-263c88ec.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-eab170b8.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-044be391.svg"></head><body class="rustdoc struct"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><rustdoc-topbar><h2><a href="#">AppState</a></h2></rustdoc-topbar><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../chibi_core/index.html">chibi_<wbr>core</a><span class="version">0.8.10</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">AppState</a></h2><h3><a href="#fields">Fields</a></h3><ul class="block structfield"><li><a href="#structfield.active_state_cache" title="active_state_cache">active_state_cache</a></li><li><a href="#structfield.chibi_dir" title="chibi_dir">chibi_dir</a></li><li><a href="#structfield.config" title="config">config</a></li><li><a href="#structfield.contexts_dir" title="contexts_dir">contexts_dir</a></li><li><a href="#structfield.models_config" title="models_config">models_config</a></li><li><a href="#structfield.plugins_dir" title="plugins_dir">plugins_dir</a></li><li><a href="#structfield.prompts_dir" title="prompts_dir">prompts_dir</a></li><li><a href="#structfield.state" title="state">state</a></li><li><a href="#structfield.state_path" title="state_path">state_path</a></li><li><a href="#structfield.vfs" title="vfs">vfs</a></li></ul><h3><a href="#implementations">Methods</a></h3><ul class="block method"><li><a href="#method.add_message" title="add_message">add_message</a></li><li><a href="#method.append_context_entry" title="append_context_entry">append_context_entry</a></li><li><a href="#method.append_to_inbox" title="append_to_inbox">append_to_inbox</a></li><li><a href="#method.append_to_transcript" title="append_to_transcript">append_to_transcript</a></li><li><a href="#method.append_to_transcript_and_context" title="append_to_transcript_and_context">append_to_transcript_and_context</a></li><li><a href="#method.auto_destroy_expired_contexts" title="auto_destroy_expired_contexts">auto_destroy_expired_contexts</a></li><li><a href="#method.calculate_token_count" title="calculate_token_count">calculate_token_count</a></li><li><a href="#method.check_system_prompt_mtime_change" title="check_system_prompt_mtime_change">check_system_prompt_mtime_change</a></li><li><a href="#method.cleanup_all_tool_caches" title="cleanup_all_tool_caches">cleanup_all_tool_caches</a></li><li><a href="#method.cleanup_tool_cache" title="cleanup_tool_cache">cleanup_tool_cache</a></li><li><a href="#method.clear_context" title="clear_context">clear_context</a></li><li><a href="#method.clear_tool_cache" title="clear_tool_cache">clear_tool_cache</a></li><li><a href="#method.destroy_context" title="destroy_context">destroy_context</a></li><li><a href="#method.ensure_context_dir" title="ensure_context_dir">ensure_context_dir</a></li><li><a href="#method.entries_to_messages" title="entries_to_messages">entries_to_messages</a></li><li><a href="#method.finalize_compaction" title="finalize_compaction">finalize_compaction</a></li><li><a href="#method.get_context_created_at" title="get_context_created_at">get_context_created_at</a></li><li><a href="#method.get_file_mtime" title="get_file_mtime">get_file_mtime</a></li><li><a href="#method.get_or_create_context" title="get_or_create_context">get_or_create_context</a></li><li><a href="#method.inbox_file" title="inbox_file">inbox_file</a></li><li><a href="#method.inbox_lock_file" title="inbox_lock_file">inbox_lock_file</a></li><li><a href="#method.is_context_dirty" title="is_context_dirty">is_context_dirty</a></li><li><a href="#method.list_contexts" title="list_contexts">list_contexts</a></li><li><a href="#method.load" title="load">load</a></li><li><a href="#method.load_and_clear_inbox" title="load_and_clear_inbox">load_and_clear_inbox</a></li><li><a href="#method.load_context" title="load_context">load_context</a></li><li><a href="#method.load_context_from_jsonl" title="load_context_from_jsonl">load_context_from_jsonl</a></li><li><a href="#method.load_context_meta" title="load_context_meta">load_context_meta</a></li><li><a href="#method.load_goals" title="load_goals">load_goals</a></li><li><a href="#method.load_goals_for" title="load_goals_for">load_goals_for</a></li><li><a href="#method.load_local_config" title="load_local_config">load_local_config</a></li><li><a href="#method.load_prompt" title="load_prompt">load_prompt</a></li><li><a href="#method.load_reflection" title="load_reflection">load_reflection</a></li><li><a href="#method.load_reflection_prompt" title="load_reflection_prompt">load_reflection_prompt</a></li><li><a href="#method.load_system_prompt_for" title="load_system_prompt_for">load_system_prompt_for</a></li><li><a href="#method.load_todos" title="load_todos">load_todos</a></li><li><a href="#method.load_todos_for" title="load_todos_for">load_todos_for</a></li><li><a href="#method.mark_context_clean" title="mark_context_clean">mark_context_clean</a></li><li><a href="#method.mark_context_dirty" title="mark_context_dirty">mark_context_dirty</a></li><li><a href="#method.messages_to_entries" title="messages_to_entries">messages_to_entries</a></li><li><a href="#method.migrate_and_load_context" title="migrate_and_load_context">migrate_and_load_context</a></li><li><a href="#method.migrate_transcript_if_needed" title="migrate_transcript_if_needed">migrate_transcript_if_needed</a></li><li><a href="#method.peek_inbox" title="peek_inbox">peek_inbox</a></li><li><a href="#method.read_context_entries" title="read_context_entries">read_context_entries</a></li><li><a href="#method.read_jsonl_transcript" title="read_jsonl_transcript">read_jsonl_transcript</a></li><li><a href="#method.read_transcript_entries" title="read_transcript_entries">read_transcript_entries</a></li><li><a href="#method.rebuild_context_from_transcript" title="rebuild_context_from_transcript">rebuild_context_from_transcript</a></li><li><a href="#method.remaining_tokens" title="remaining_tokens">remaining_tokens</a></li><li><a href="#method.rename_context" title="rename_context">rename_context</a></li><li><a href="#method.resolve_config" title="resolve_config">resolve_config</a></li><li><a href="#method.resolve_model_name" title="resolve_model_name">resolve_model_name</a></li><li><a href="#method.save" title="save">save</a></li><li><a href="#method.save_and_register_context" title="save_and_register_context">save_and_register_context</a></li><li><a href="#method.save_combined_system_prompt" title="save_combined_system_prompt">save_combined_system_prompt</a></li><li><a href="#method.save_context" title="save_context">save_context</a></li><li><a href="#method.save_context_meta" title="save_context_meta">save_context_meta</a></li><li><a href="#method.save_goals" title="save_goals">save_goals</a></li><li><a href="#method.save_local_config" title="save_local_config">save_local_config</a></li><li><a href="#method.save_todos" title="save_todos">save_todos</a></li><li><a href="#method.send_inbox_message_from" title="send_inbox_message_from">send_inbox_message_from</a></li><li><a href="#method.set_system_prompt_for" title="set_system_prompt_for">set_system_prompt_for</a></li><li><a href="#method.should_auto_compact" title="should_auto_compact">should_auto_compact</a></li><li><a href="#method.should_warn" title="should_warn">should_warn</a></li><li><a href="#method.sync_state_with_filesystem" title="sync_state_with_filesystem">sync_state_with_filesystem</a></li><li><a href="#method.touch_context_with_destroy_settings" title="touch_context_with_destroy_settings">touch_context_with_destroy_settings</a></li><li><a href="#method.update_system_prompt_mtime" title="update_system_prompt_mtime">update_system_prompt_mtime</a></li><li><a href="#method.validate_config" title="validate_config">validate_config</a></li><li><a href="#method.write_context_entries" title="write_context_entries">write_context_entries</a></li></ul><h3><a href="#trait-implementations">Trait Implementations</a></h3><ul class="block trait-implementation"><li><a href="#impl-StatePaths-for-AppState" title="StatePaths">StatePaths</a></li></ul><h3><a href="#synthetic-implementations">Auto Trait Implementations</a></h3><ul class="block synthetic-implementation"><li><a href="#impl-Freeze-for-AppState" title="!Freeze">!Freeze</a></li><li><a href="#impl-RefUnwindSafe-for-AppState" title="!RefUnwindSafe">!RefUnwindSafe</a></li><li><a href="#impl-Sync-for-AppState" title="!Sync">!Sync</a></li><li><a href="#impl-UnwindSafe-for-AppState" title="!UnwindSafe">!UnwindSafe</a></li><li><a href="#impl-Send-for-AppState" title="Send">Send</a></li><li><a href="#impl-Unpin-for-AppState" title="Unpin">Unpin</a></li></ul><h3><a href="#blanket-implementations">Blanket Implementations</a></h3><ul class="block blanket-implementation"><li><a href="#impl-Any-for-T" title="Any">Any</a></li><li><a href="#impl-Borrow%3CT%3E-for-T" title="Borrow&#60;T&#62;">Borrow&#60;T&#62;</a></li><li><a href="#impl-BorrowMut%3CT%3E-for-T" title="BorrowMut&#60;T&#62;">BorrowMut&#60;T&#62;</a></li><li><a href="#impl-From%3CT%3E-for-T" title="From&#60;T&#62;">From&#60;T&#62;</a></li><li><a href="#impl-Instrument-for-T" title="Instrument">Instrument</a></li><li><a href="#impl-Into%3CU%3E-for-T" title="Into&#60;U&#62;">Into&#60;U&#62;</a></li><li><a href="#impl-IntoEither-for-T" title="IntoEither">IntoEither</a></li><li><a href="#impl-IntoShared%3CShared%3E-for-Unshared" title="IntoShared&#60;Shared&#62;">IntoShared&#60;Shared&#62;</a></li><li><a href="#impl-Pointable-for-T" title="Pointable">Pointable</a></li><li><a href="#impl-PolicyExt-for-T" title="PolicyExt">PolicyExt</a></li><li><a href="#impl-Same-for-T" title="Same">Same</a></li><li><a href="#impl-TryFrom%3CU%3E-for-T" title="TryFrom&#60;U&#62;">TryFrom&#60;U&#62;</a></li><li><a href="#impl-TryInto%3CU%3E-for-T" title="TryInto&#60;U&#62;">TryInto&#60;U&#62;</a></li><li><a href="#impl-VZip%3CV%3E-for-T" title="VZip&#60;V&#62;">VZip&#60;V&#62;</a></li><li><a href="#impl-WithSubscriber-for-T" title="WithSubscriber">WithSubscriber</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="index.html">In chibi_<wbr>core::<wbr>state</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../index.html">chibi_core</a>::<wbr><a href="index.html">state</a></div><h1>Struct <span class="struct">AppState</span>&nbsp;<button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../src/chibi_core/state/mod.rs.html#39-54">Source</a> </span></div><pre class="rust item-decl"><code>pub struct AppState {
    pub config: <a class="struct" href="../config/struct.Config.html" title="struct chibi_core::config::Config">Config</a>,
    pub models_config: <a class="struct" href="../config/struct.ModelsConfig.html" title="struct chibi_core::config::ModelsConfig">ModelsConfig</a>,
    pub state: <a class="struct" href="../context/struct.ContextState.html" title="struct chibi_core::context::ContextState">ContextState</a>,
    pub chibi_dir: <a class="struct" href="https://doc.rust-lang.org/1.93.1/std/path/struct.PathBuf.html" title="struct std::path::PathBuf">PathBuf</a>,
    pub state_path: <a class="struct" href="https://doc.rust-lang.org/1.93.1/std/path/struct.PathBuf.html" title="struct std::path::PathBuf">PathBuf</a>,
    pub contexts_dir: <a class="struct" href="https://doc.rust-lang.org/1.93.1/std/path/struct.PathBuf.html" title="struct std::path::PathBuf">PathBuf</a>,
    pub prompts_dir: <a class="struct" href="https://doc.rust-lang.org/1.93.1/std/path/struct.PathBuf.html" title="struct std::path::PathBuf">PathBuf</a>,
    pub plugins_dir: <a class="struct" href="https://doc.rust-lang.org/1.93.1/std/path/struct.PathBuf.html" title="struct std::path::PathBuf">PathBuf</a>,
    pub vfs: <a class="struct" href="../vfs/struct.Vfs.html" title="struct chibi_core::vfs::Vfs">Vfs</a>,
    active_state_cache: <a class="struct" href="https://doc.rust-lang.org/1.93.1/core/cell/struct.RefCell.html" title="struct core::cell::RefCell">RefCell</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.1/std/collections/hash/map/struct.HashMap.html" title="struct std::collections::hash::map::HashMap">HashMap</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.1/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>, <a class="struct" href="../partition/struct.ActiveState.html" title="struct chibi_core::partition::ActiveState">ActiveState</a>&gt;&gt;,
}</code></pre><h2 id="fields" class="fields section-header">Fields<a href="#fields" class="anchor">§</a></h2><span id="structfield.config" class="structfield section-header"><a href="#structfield.config" class="anchor field">§</a><code>config: <a class="struct" href="../config/struct.Config.html" title="struct chibi_core::config::Config">Config</a></code></span><span id="structfield.models_config" class="structfield section-header"><a href="#structfield.models_config" class="anchor field">§</a><code>models_config: <a class="struct" href="../config/struct.ModelsConfig.html" title="struct chibi_core::config::ModelsConfig">ModelsConfig</a></code></span><span id="structfield.state" class="structfield section-header"><a href="#structfield.state" class="anchor field">§</a><code>state: <a class="struct" href="../context/struct.ContextState.html" title="struct chibi_core::context::ContextState">ContextState</a></code></span><span id="structfield.chibi_dir" class="structfield section-header"><a href="#structfield.chibi_dir" class="anchor field">§</a><code>chibi_dir: <a class="struct" href="https://doc.rust-lang.org/1.93.1/std/path/struct.PathBuf.html" title="struct std::path::PathBuf">PathBuf</a></code></span><span id="structfield.state_path" class="structfield section-header"><a href="#structfield.state_path" class="anchor field">§</a><code>state_path: <a class="struct" href="https://doc.rust-lang.org/1.93.1/std/path/struct.PathBuf.html" title="struct std::path::PathBuf">PathBuf</a></code></span><span id="structfield.contexts_dir" class="structfield section-header"><a href="#structfield.contexts_dir" class="anchor field">§</a><code>contexts_dir: <a class="struct" href="https://doc.rust-lang.org/1.93.1/std/path/struct.PathBuf.html" title="struct std::path::PathBuf">PathBuf</a></code></span><span id="structfield.prompts_dir" class="structfield section-header"><a href="#structfield.prompts_dir" class="anchor field">§</a><code>prompts_dir: <a class="struct" href="https://doc.rust-lang.org/1.93.1/std/path/struct.PathBuf.html" title="struct std::path::PathBuf">PathBuf</a></code></span><span id="structfield.plugins_dir" class="structfield section-header"><a href="#structfield.plugins_dir" class="anchor field">§</a><code>plugins_dir: <a class="struct" href="https://doc.rust-lang.org/1.93.1/std/path/struct.PathBuf.html" title="struct std::path::PathBuf">PathBuf</a></code></span><span id="structfield.vfs" class="structfield section-header"><a href="#structfield.vfs" class="anchor field">§</a><code>vfs: <a class="struct" href="../vfs/struct.Vfs.html" title="struct chibi_core::vfs::Vfs">Vfs</a></code></span><div class="docblock"><p>Shared virtual file system.</p>
</div><span id="structfield.active_state_cache" class="structfield section-header"><a href="#structfield.active_state_cache" class="anchor field">§</a><code>active_state_cache: <a class="struct" href="https://doc.rust-lang.org/1.93.1/core/cell/struct.RefCell.html" title="struct core::cell::RefCell">RefCell</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.1/std/collections/hash/map/struct.HashMap.html" title="struct std::collections::hash::map::HashMap">HashMap</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.1/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>, <a class="struct" href="../partition/struct.ActiveState.html" title="struct chibi_core::partition::ActiveState">ActiveState</a>&gt;&gt;</code></span><div class="docblock"><p>Cache of active partition state per context, avoiding repeated file scans.
Uses interior mutability since caching is a side effect that doesn’t change
logical state.</p>
</div><h2 id="implementations" class="section-header">Implementations<a href="#implementations" class="anchor">§</a></h2><div id="implementations-list"><details class="toggle implementors-toggle" open><summary><section id="impl-AppState" class="impl"><a class="src rightside" href="../../src/chibi_core/inbox.rs.html#14-143">Source</a><a href="#impl-AppState" class="anchor">§</a><h3 class="code-header">impl <a class="struct" href="struct.AppState.html" title="struct chibi_core::state::AppState">AppState</a></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.inbox_file" class="method"><a class="src rightside" href="../../src/chibi_core/inbox.rs.html#16-18">Source</a><h4 class="code-header">pub fn <a href="#method.inbox_file" class="fn">inbox_file</a>(&amp;self, context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.93.1/std/path/struct.PathBuf.html" title="struct std::path::PathBuf">PathBuf</a></h4></section></summary><div class="docblock"><p>Get the path to a context’s inbox file</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.inbox_lock_file" class="method"><a class="src rightside" href="../../src/chibi_core/inbox.rs.html#21-23">Source</a><h4 class="code-header">pub fn <a href="#method.inbox_lock_file" class="fn">inbox_lock_file</a>(&amp;self, context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.93.1/std/path/struct.PathBuf.html" title="struct std::path::PathBuf">PathBuf</a></h4></section></summary><div class="docblock"><p>Get the path to a context’s inbox lock file</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.send_inbox_message_from" class="method"><a class="src rightside" href="../../src/chibi_core/inbox.rs.html#26-40">Source</a><h4 class="code-header">pub fn <a href="#method.send_inbox_message_from" class="fn">send_inbox_message_from</a>(
    &amp;self,
    from_context: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>,
    to_context: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>,
    message: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>,
) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Send a message from a specified context to another context’s inbox</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.append_to_inbox" class="method"><a class="src rightside" href="../../src/chibi_core/inbox.rs.html#43-64">Source</a><h4 class="code-header">pub fn <a href="#method.append_to_inbox" class="fn">append_to_inbox</a>(
    &amp;self,
    context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>,
    entry: &amp;<a class="struct" href="../context/struct.InboxEntry.html" title="struct chibi_core::context::InboxEntry">InboxEntry</a>,
) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Append a message to a context’s inbox with exclusive locking</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.load_and_clear_inbox" class="method"><a class="src rightside" href="../../src/chibi_core/inbox.rs.html#69-110">Source</a><h4 class="code-header">pub fn <a href="#method.load_and_clear_inbox" class="fn">load_and_clear_inbox</a>(
    &amp;self,
    context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>,
) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.1/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="struct" href="../context/struct.InboxEntry.html" title="struct chibi_core::context::InboxEntry">InboxEntry</a>&gt;&gt;</h4></section></summary><div class="docblock"><p>Load and clear a context’s inbox atomically.</p>
<p>This is the parameterized version - use this when you know the context name.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.peek_inbox" class="method"><a class="src rightside" href="../../src/chibi_core/inbox.rs.html#117-142">Source</a><h4 class="code-header">pub fn <a href="#method.peek_inbox" class="fn">peek_inbox</a>(&amp;self, context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.1/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="struct" href="../context/struct.InboxEntry.html" title="struct chibi_core::context::InboxEntry">InboxEntry</a>&gt;&gt;</h4></section></summary><div class="docblock"><p>Peek at a context’s inbox without clearing it.</p>
<p>This is useful for checking if there are messages before deciding
whether to activate a context. Unlike <code>load_and_clear_inbox</code>, this
does not modify the inbox file.</p>
</div></details></div></details><details class="toggle implementors-toggle" open><summary><section id="impl-AppState-1" class="impl"><a class="src rightside" href="../../src/chibi_core/state/config_resolution.rs.html#13-201">Source</a><a href="#impl-AppState-1" class="anchor">§</a><h3 class="code-header">impl <a class="struct" href="struct.AppState.html" title="struct chibi_core::state::AppState">AppState</a></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.load_local_config" class="method"><a class="src rightside" href="../../src/chibi_core/state/config_resolution.rs.html#15-28">Source</a><h4 class="code-header">pub fn <a href="#method.load_local_config" class="fn">load_local_config</a>(&amp;self, context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="struct" href="../config/struct.LocalConfig.html" title="struct chibi_core::config::LocalConfig">LocalConfig</a>&gt;</h4></section></summary><div class="docblock"><p>Load local config for a context (returns default if doesn’t exist)</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.save_local_config" class="method"><a class="src rightside" href="../../src/chibi_core/state/config_resolution.rs.html#31-41">Source</a><h4 class="code-header">pub fn <a href="#method.save_local_config" class="fn">save_local_config</a>(
    &amp;self,
    context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>,
    local_config: &amp;<a class="struct" href="../config/struct.LocalConfig.html" title="struct chibi_core::config::LocalConfig">LocalConfig</a>,
) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Save local config for a context (atomic write)</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.resolve_model_name" class="method"><a class="src rightside" href="../../src/chibi_core/state/config_resolution.rs.html#46-54">Source</a><h4 class="code-header">pub fn <a href="#method.resolve_model_name" class="fn">resolve_model_name</a>(&amp;self, model: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.93.1/alloc/string/struct.String.html" title="struct alloc::string::String">String</a></h4></section></summary><div class="docblock"><p>Resolve model name using models.toml aliases
If the model is an alias defined in models.toml, return the full model name
Otherwise return the original model name</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.resolve_config" class="method"><a class="src rightside" href="../../src/chibi_core/state/config_resolution.rs.html#63-159">Source</a><h4 class="code-header">pub fn <a href="#method.resolve_config" class="fn">resolve_config</a>(
    &amp;self,
    context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>,
    username_override: <a class="enum" href="https://doc.rust-lang.org/1.93.1/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;&amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>&gt;,
) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="struct" href="../config/struct.ResolvedConfig.html" title="struct chibi_core::config::ResolvedConfig">ResolvedConfig</a>&gt;</h4></section></summary><div class="docblock"><p>Resolve the full configuration, applying overrides in order:</p>
<ol>
<li>Runtime override (passed as parameter, highest priority)</li>
<li>Context-local config (local.toml)</li>
<li>Models.toml (per-model API params)</li>
<li>Environment variables (<code>CHIBI_API_KEY</code>, <code>CHIBI_MODEL</code>)</li>
<li>Global config (config.toml)</li>
<li>Defaults</li>
</ol>
</div></details><details class="toggle method-toggle" open><summary><section id="method.validate_config" class="method"><a class="src rightside" href="../../src/chibi_core/state/config_resolution.rs.html#164-200">Source</a><h4 class="code-header">pub fn <a href="#method.validate_config" class="fn">validate_config</a>(
    &amp;self,
    resolved: &amp;<a class="struct" href="../config/struct.ResolvedConfig.html" title="struct chibi_core::config::ResolvedConfig">ResolvedConfig</a>,
    tools: &amp;[<a class="struct" href="../tools/struct.Tool.html" title="struct chibi_core::tools::Tool">Tool</a>],
) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Validate resolved config against loaded tools</p>
<p>Checks that fallback_tool exists and has flow_control=true metadata.</p>
</div></details></div></details><details class="toggle implementors-toggle" open><summary><section id="impl-AppState-2" class="impl"><a class="src rightside" href="../../src/chibi_core/state/context_ops.rs.html#11-170">Source</a><a href="#impl-AppState-2" class="anchor">§</a><h3 class="code-header">impl <a class="struct" href="struct.AppState.html" title="struct chibi_core::state::AppState">AppState</a></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.get_or_create_context" class="method"><a class="src rightside" href="../../src/chibi_core/state/context_ops.rs.html#16-25">Source</a><h4 class="code-header">pub fn <a href="#method.get_or_create_context" class="fn">get_or_create_context</a>(&amp;self, name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="struct" href="../context/struct.Context.html" title="struct chibi_core::context::Context">Context</a>&gt;</h4></section></summary><div class="docblock"><p>Get or create a context by name.</p>
<p>Returns an existing context if found, or creates a new empty one.
This is the parameterized version of <code>get_current_context</code>.</p>
</div></details><section id="method.save_and_register_context" class="method"><a class="src rightside" href="../../src/chibi_core/state/context_ops.rs.html#27-51">Source</a><h4 class="code-header">pub fn <a href="#method.save_and_register_context" class="fn">save_and_register_context</a>(&amp;self, context: &amp;<a class="struct" href="../context/struct.Context.html" title="struct chibi_core::context::Context">Context</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.unit.html">()</a>&gt;</h4></section><section id="method.add_message" class="method"><a class="src rightside" href="../../src/chibi_core/state/context_ops.rs.html#53-60">Source</a><h4 class="code-header">pub fn <a href="#method.add_message" class="fn">add_message</a>(&amp;self, context: &amp;mut <a class="struct" href="../context/struct.Context.html" title="struct chibi_core::context::Context">Context</a>, role: <a class="struct" href="https://doc.rust-lang.org/1.93.1/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>, content: <a class="struct" href="https://doc.rust-lang.org/1.93.1/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>)</h4></section><details class="toggle method-toggle" open><summary><section id="method.clear_context" class="method"><a class="src rightside" href="../../src/chibi_core/state/context_ops.rs.html#72-95">Source</a><h4 class="code-header">pub fn <a href="#method.clear_context" class="fn">clear_context</a>(&amp;self, context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Clear the current context (archive history).</p>
<h5 id="concurrency"><a class="doc-anchor" href="#concurrency">§</a>Concurrency</h5>
<p>This function is safe to call without holding a <code>ContextLock</code> because:</p>
<ul>
<li>Transcript writes use <code>FileLock</code> via <code>append_to_transcript</code></li>
<li>Context saves use atomic writes via <code>save_context</code></li>
</ul>
<p>If another process is running <code>send_prompt</code>, the transcript operations
will serialize correctly via their respective locks.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.destroy_context" class="method"><a class="src rightside" href="../../src/chibi_core/state/context_ops.rs.html#103-120">Source</a><h4 class="code-header">pub fn <a href="#method.destroy_context" class="fn">destroy_context</a>(&amp;mut self, name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.bool.html">bool</a>&gt;</h4></section></summary><div class="docblock"><p>Destroy a context and its directory.</p>
<p>Returns <code>true</code> if the context existed and was destroyed, <code>false</code> if it didn’t exist.</p>
<p>Note: Session state (what was current/previous) is managed by CLI. This method
just deletes the context. Caller is responsible for updating session if needed.</p>
</div></details><section id="method.rename_context" class="method"><a class="src rightside" href="../../src/chibi_core/state/context_ops.rs.html#122-164">Source</a><h4 class="code-header">pub fn <a href="#method.rename_context" class="fn">rename_context</a>(&amp;mut self, old_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>, new_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.unit.html">()</a>&gt;</h4></section><section id="method.list_contexts" class="method"><a class="src rightside" href="../../src/chibi_core/state/context_ops.rs.html#166-169">Source</a><h4 class="code-header">pub fn <a href="#method.list_contexts" class="fn">list_contexts</a>(&amp;self) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.93.1/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.1/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>&gt;</h4></section></div></details><details class="toggle implementors-toggle" open><summary><section id="impl-AppState-3" class="impl"><a class="src rightside" href="../../src/chibi_core/state/prompts.rs.html#28-233">Source</a><a href="#impl-AppState-3" class="anchor">§</a><h3 class="code-header">impl <a class="struct" href="struct.AppState.html" title="struct chibi_core::state::AppState">AppState</a></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.load_prompt" class="method"><a class="src rightside" href="../../src/chibi_core/state/prompts.rs.html#31-37">Source</a><h4 class="code-header">pub fn <a href="#method.load_prompt" class="fn">load_prompt</a>(&amp;self, name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.1/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>&gt;</h4></section></summary><div class="docblock"><p>Load a named prompt from ~/.chibi/prompts/<name>.md, falling back to the
compiled-in default if no override is installed.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.load_system_prompt_for" class="method"><a class="src rightside" href="../../src/chibi_core/state/prompts.rs.html#43-51">Source</a><h4 class="code-header">pub fn <a href="#method.load_system_prompt_for" class="fn">load_system_prompt_for</a>(&amp;self, context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.1/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>&gt;</h4></section></summary><div class="docblock"><p>Load the system prompt for a specific context.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.set_system_prompt_for" class="method"><a class="src rightside" href="../../src/chibi_core/state/prompts.rs.html#56-92">Source</a><h4 class="code-header">pub fn <a href="#method.set_system_prompt_for" class="fn">set_system_prompt_for</a>(
    &amp;self,
    context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>,
    content: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>,
) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Set a custom system prompt for a specific context.
This also logs a system_prompt_changed event (with full content) to transcript,
updates the mtime in context_meta, and invalidates the prefix.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.update_system_prompt_mtime" class="method"><a class="src rightside" href="../../src/chibi_core/state/prompts.rs.html#95-102">Source</a><h4 class="code-header">fn <a href="#method.update_system_prompt_mtime" class="fn">update_system_prompt_mtime</a>(&amp;self, context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Update system_prompt_md_mtime in context_meta to current file mtime</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.get_file_mtime" class="method"><a class="src rightside" href="../../src/chibi_core/state/prompts.rs.html#105-115">Source</a><h4 class="code-header">fn <a href="#method.get_file_mtime" class="fn">get_file_mtime</a>(&amp;self, path: &amp;<a class="struct" href="https://doc.rust-lang.org/1.93.1/std/path/struct.Path.html" title="struct std::path::Path">Path</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.93.1/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.u64.html">u64</a>&gt;</h4></section></summary><div class="docblock"><p>Get file mtime as unix timestamp, or None if file doesn’t exist</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.check_system_prompt_mtime_change" class="method"><a class="src rightside" href="../../src/chibi_core/state/prompts.rs.html#119-155">Source</a><h4 class="code-header">pub(crate) fn <a href="#method.check_system_prompt_mtime_change" class="fn">check_system_prompt_mtime_change</a>(
    &amp;self,
    context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>,
) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Check if system_prompt.md was modified externally since last tracked mtime.
If so, log the new prompt to transcript, update mtime, and mark context dirty.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.save_combined_system_prompt" class="method"><a class="src rightside" href="../../src/chibi_core/state/prompts.rs.html#159-167">Source</a><h4 class="code-header">pub fn <a href="#method.save_combined_system_prompt" class="fn">save_combined_system_prompt</a>(
    &amp;self,
    context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>,
    combined_prompt: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>,
) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Store the combined system prompt (with hook injections) in context_meta.
This allows reconstructing the full API request from context.jsonl + context_meta.json.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.load_reflection" class="method"><a class="src rightside" href="../../src/chibi_core/state/prompts.rs.html#170-172">Source</a><h4 class="code-header">pub fn <a href="#method.load_reflection" class="fn">load_reflection</a>(&amp;self) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.1/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>&gt;</h4></section></summary><div class="docblock"><p>Load the reflection content from ~/.chibi/prompts/reflection.md</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.load_todos_for" class="method"><a class="src rightside" href="../../src/chibi_core/state/prompts.rs.html#175-177">Source</a><h4 class="code-header">pub fn <a href="#method.load_todos_for" class="fn">load_todos_for</a>(&amp;self, context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.1/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>&gt;</h4></section></summary><div class="docblock"><p>Load todos for a specific context (alias for load_todos)</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.load_goals_for" class="method"><a class="src rightside" href="../../src/chibi_core/state/prompts.rs.html#180-182">Source</a><h4 class="code-header">pub fn <a href="#method.load_goals_for" class="fn">load_goals_for</a>(&amp;self, context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.1/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>&gt;</h4></section></summary><div class="docblock"><p>Load goals for a specific context (alias for load_goals)</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.load_reflection_prompt" class="method"><a class="src rightside" href="../../src/chibi_core/state/prompts.rs.html#186-193">Source</a><h4 class="code-header">pub fn <a href="#method.load_reflection_prompt" class="fn">load_reflection_prompt</a>(&amp;self) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.1/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>&gt;</h4></section></summary><div class="docblock"><p>Load the reflection prompt from ~/.chibi/prompts/reflection.md
Returns empty string if the file doesn’t exist</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.load_todos" class="method"><a class="src rightside" href="../../src/chibi_core/state/prompts.rs.html#198-205">Source</a><h4 class="code-header">pub fn <a href="#method.load_todos" class="fn">load_todos</a>(&amp;self, context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.1/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>&gt;</h4></section></summary><div class="docblock"><p>Load todos for a context (returns empty string if file doesn’t exist)</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.load_goals" class="method"><a class="src rightside" href="../../src/chibi_core/state/prompts.rs.html#208-215">Source</a><h4 class="code-header">pub fn <a href="#method.load_goals" class="fn">load_goals</a>(&amp;self, context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.1/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>&gt;</h4></section></summary><div class="docblock"><p>Load goals for a context (returns empty string if file doesn’t exist)</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.save_todos" class="method"><a class="src rightside" href="../../src/chibi_core/state/prompts.rs.html#218-221">Source</a><h4 class="code-header">pub fn <a href="#method.save_todos" class="fn">save_todos</a>(&amp;self, context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>, content: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Save todos for a context (atomic write)</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.save_goals" class="method"><a class="src rightside" href="../../src/chibi_core/state/prompts.rs.html#224-227">Source</a><h4 class="code-header">pub fn <a href="#method.save_goals" class="fn">save_goals</a>(&amp;self, context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>, content: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Save goals for a context (atomic write)</p>
</div></details></div></details><details class="toggle implementors-toggle" open><summary><section id="impl-AppState-4" class="impl"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#62-1101">Source</a><a href="#impl-AppState-4" class="anchor">§</a><h3 class="code-header">impl <a class="struct" href="struct.AppState.html" title="struct chibi_core::state::AppState">AppState</a></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.load" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#114-212">Source</a><h4 class="code-header">pub fn <a href="#method.load" class="fn">load</a>(home_override: <a class="enum" href="https://doc.rust-lang.org/1.93.1/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.1/std/path/struct.PathBuf.html" title="struct std::path::PathBuf">PathBuf</a>&gt;) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;Self&gt;</h4></section></summary><div class="docblock"><p>Load AppState with optional home directory override.</p>
<p>Precedence for chibi directory:</p>
<ol>
<li><code>home_override</code> parameter (from –home CLI flag)</li>
<li><code>CHIBI_HOME</code> environment variable</li>
<li><code>~/.chibi</code> default</li>
</ol>
</div></details><section id="method.save" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#214-216">Source</a><h4 class="code-header">pub fn <a href="#method.save" class="fn">save</a>(&amp;self) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.unit.html">()</a>&gt;</h4></section><details class="toggle method-toggle" open><summary><section id="method.sync_state_with_filesystem" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#228-266">Source</a><h4 class="code-header">pub fn <a href="#method.sync_state_with_filesystem" class="fn">sync_state_with_filesystem</a>(&amp;mut self) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.bool.html">bool</a>&gt;</h4></section></summary><div class="docblock"><p>Synchronize state.json with filesystem reality.
Called during startup after reading state.json.</p>
<p>Operations:</p>
<ol>
<li>Remove entries whose directories no longer exist</li>
<li>Register orphan directories (exist on disk but not in state)</li>
</ol>
<p>Note: Session state (current/previous context) is now managed by CLI.</p>
<p>Returns true if state was modified (needs saving)</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.touch_context_with_destroy_settings" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#271-289">Source</a><h4 class="code-header">pub fn <a href="#method.touch_context_with_destroy_settings" class="fn">touch_context_with_destroy_settings</a>(
    &amp;mut self,
    name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>,
    destroy_at: <a class="enum" href="https://doc.rust-lang.org/1.93.1/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.u64.html">u64</a>&gt;,
    destroy_after_seconds_inactive: <a class="enum" href="https://doc.rust-lang.org/1.93.1/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.u64.html">u64</a>&gt;,
) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.bool.html">bool</a>&gt;</h4></section></summary><div class="docblock"><p>Update the last_activity_at timestamp for a context and optionally set destroy settings.
The destroy settings come from <code>ExecutionFlags.destroy_at</code> and
<code>ExecutionFlags.destroy_after_seconds_inactive</code>.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.auto_destroy_expired_contexts" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#296-321">Source</a><h4 class="code-header">pub fn <a href="#method.auto_destroy_expired_contexts" class="fn">auto_destroy_expired_contexts</a>(&amp;mut self) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.1/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.1/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>&gt;&gt;</h4></section></summary><div class="docblock"><p>Auto-destroy contexts that have expired based on their settings.
Returns the list of destroyed context names.</p>
<p>Note: This now destroys ALL expired contexts. The CLI is responsible for
checking if the session’s current context was destroyed and handling it.</p>
</div></details><section id="method.ensure_context_dir" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#323-326">Source</a><h4 class="code-header">pub fn <a href="#method.ensure_context_dir" class="fn">ensure_context_dir</a>(&amp;self, name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.unit.html">()</a>&gt;</h4></section><details class="toggle method-toggle" open><summary><section id="method.clear_tool_cache" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#329-338">Source</a><h4 class="code-header">pub async fn <a href="#method.clear_tool_cache" class="fn">clear_tool_cache</a>(&amp;self, name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Clear the tool cache for a context (deletes all entries from VFS).</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.cleanup_tool_cache" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#342-387">Source</a><h4 class="code-header">pub async fn <a href="#method.cleanup_tool_cache" class="fn">cleanup_tool_cache</a>(
    &amp;self,
    context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>,
    max_age_days: <a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.u64.html">u64</a>,
) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.usize.html">usize</a>&gt;</h4></section></summary><div class="docblock"><p>Clean up tool cache entries older than <code>max_age_days</code> for a single context.
Returns the number of entries removed.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.cleanup_all_tool_caches" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#390-409">Source</a><h4 class="code-header">pub async fn <a href="#method.cleanup_all_tool_caches" class="fn">cleanup_all_tool_caches</a>(&amp;self, max_age_days: <a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.u64.html">u64</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.usize.html">usize</a>&gt;</h4></section></summary><div class="docblock"><p>Clean up tool cache entries for all contexts. Returns total entries removed.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.is_context_dirty" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#419-421">Source</a><h4 class="code-header">pub fn <a href="#method.is_context_dirty" class="fn">is_context_dirty</a>(&amp;self, name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.bool.html">bool</a></h4></section></summary><div class="docblock"><p>Check if the context is dirty (needs prefix rebuild)</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.mark_context_dirty" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#424-428">Source</a><h4 class="code-header">pub fn <a href="#method.mark_context_dirty" class="fn">mark_context_dirty</a>(&amp;self, name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Mark the context as dirty (triggers rebuild on next load)</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.mark_context_clean" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#431-437">Source</a><h4 class="code-header">pub fn <a href="#method.mark_context_clean" class="fn">mark_context_clean</a>(&amp;self, name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Mark the context as clean (remove dirty marker after rebuild)</p>
</div></details><section id="method.load_context" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#439-466">Source</a><h4 class="code-header">pub fn <a href="#method.load_context" class="fn">load_context</a>(&amp;self, name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="struct" href="../context/struct.Context.html" title="struct chibi_core::context::Context">Context</a>&gt;</h4></section><details class="toggle method-toggle" open><summary><section id="method.load_context_from_jsonl" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#469-505">Source</a><h4 class="code-header">fn <a href="#method.load_context_from_jsonl" class="fn">load_context_from_jsonl</a>(&amp;self, name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="struct" href="../context/struct.Context.html" title="struct chibi_core::context::Context">Context</a>&gt;</h4></section></summary><div class="docblock"><p>Load context from the new JSONL format</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.rebuild_context_from_transcript" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#514-574">Source</a><h4 class="code-header">pub fn <a href="#method.rebuild_context_from_transcript" class="fn">rebuild_context_from_transcript</a>(&amp;self, name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Rebuild context.jsonl from transcript.jsonl
This creates a fresh context.jsonl with:</p>
<ul>
<li><code>[0]</code> anchor entry (context_created or latest compaction/archival from transcript)</li>
<li><code>[1..]</code> entries from transcript since the anchor</li>
</ul>
<p>Note: System prompt is NOT stored in context.jsonl. It lives in system_prompt.md
(source of truth) and context_meta.json (last combined prompt sent to API).</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.migrate_transcript_if_needed" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#577-593">Source</a><h4 class="code-header">fn <a href="#method.migrate_transcript_if_needed" class="fn">migrate_transcript_if_needed</a>(&amp;self, name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Migrate legacy transcript.jsonl to partitioned transcript/ directory</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.read_transcript_entries" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#596-602">Source</a><h4 class="code-header">pub fn <a href="#method.read_transcript_entries" class="fn">read_transcript_entries</a>(
    &amp;self,
    name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>,
) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.1/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="struct" href="../context/struct.TranscriptEntry.html" title="struct chibi_core::context::TranscriptEntry">TranscriptEntry</a>&gt;&gt;</h4></section></summary><div class="docblock"><p>Read all entries from transcript (using partitioned storage)</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.migrate_and_load_context" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#605-645">Source</a><h4 class="code-header">fn <a href="#method.migrate_and_load_context" class="fn">migrate_and_load_context</a>(&amp;self, name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="struct" href="../context/struct.Context.html" title="struct chibi_core::context::Context">Context</a>&gt;</h4></section></summary><div class="docblock"><p>Migrate from old context.json format to new context.jsonl format</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.read_context_entries" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#648-650">Source</a><h4 class="code-header">pub fn <a href="#method.read_context_entries" class="fn">read_context_entries</a>(&amp;self, name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.1/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="struct" href="../context/struct.TranscriptEntry.html" title="struct chibi_core::context::TranscriptEntry">TranscriptEntry</a>&gt;&gt;</h4></section></summary><div class="docblock"><p>Read entries from context.jsonl (the LLM’s working memory)</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.write_context_entries" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#653-665">Source</a><h4 class="code-header">pub fn <a href="#method.write_context_entries" class="fn">write_context_entries</a>(
    &amp;self,
    name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>,
    entries: &amp;[<a class="struct" href="../context/struct.TranscriptEntry.html" title="struct chibi_core::context::TranscriptEntry">TranscriptEntry</a>],
) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Write entries to context.jsonl (full rewrite, atomic)</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.append_context_entry" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#674-684">Source</a><h4 class="code-header">pub fn <a href="#method.append_context_entry" class="fn">append_context_entry</a>(
    &amp;self,
    name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>,
    entry: &amp;<a class="struct" href="../context/struct.TranscriptEntry.html" title="struct chibi_core::context::TranscriptEntry">TranscriptEntry</a>,
) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Append a single entry to context.jsonl</p>
<h5 id="durability"><a class="doc-anchor" href="#durability">§</a>Durability</h5>
<p>Writes are flushed to disk via fsync to ensure durability and consistency
with the transcript (which also fsyncs). This prevents context.jsonl from
diverging from transcript.jsonl on crash.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.load_context_meta" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#687-700">Source</a><h4 class="code-header">fn <a href="#method.load_context_meta" class="fn">load_context_meta</a>(&amp;self, name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="struct" href="../context/struct.ContextMeta.html" title="struct chibi_core::context::ContextMeta">ContextMeta</a>&gt;</h4></section></summary><div class="docblock"><p>Load context metadata</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.get_context_created_at" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#703-710">Source</a><h4 class="code-header">pub fn <a href="#method.get_context_created_at" class="fn">get_context_created_at</a>(&amp;self, name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.u64.html">u64</a></h4></section></summary><div class="docblock"><p>Get created_at timestamp for a context from state.json (single source of truth)</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.save_context_meta" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#713-717">Source</a><h4 class="code-header">fn <a href="#method.save_context_meta" class="fn">save_context_meta</a>(&amp;self, name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>, meta: &amp;<a class="struct" href="../context/struct.ContextMeta.html" title="struct chibi_core::context::ContextMeta">ContextMeta</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Save context metadata (atomic write)</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.entries_to_messages" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#737-850">Source</a><h4 class="code-header">fn <a href="#method.entries_to_messages" class="fn">entries_to_messages</a>(&amp;self, entries: &amp;[<a class="struct" href="../context/struct.TranscriptEntry.html" title="struct chibi_core::context::TranscriptEntry">TranscriptEntry</a>]) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.93.1/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="enum" href="https://docs.rs/serde_json/1.0.149/serde_json/value/enum.Value.html" title="enum serde_json::value::Value">Value</a>&gt;</h4></section></summary><div class="docblock"><p>Convert transcript entries to JSON messages, preserving tool history.</p>
<p>Walks entries sequentially:</p>
<ul>
<li>“message” entries → <code>{"_id", "role", "content"}</code></li>
<li>“tool_call” entries → grouped into API-turn batches, each emitted as an
assistant message with <code>tool_calls[]</code> followed by individual tool result messages</li>
<li>Other entry types (compaction, archival, context_created, system_prompt_changed)
are skipped.</li>
</ul>
<p><strong>Batch grouping:</strong> A batch boundary is determined structurally — a leading run of
consecutive <code>tool_call</code> entries (no interleaved results) forms one API-turn batch,
followed by exactly that many <code>tool_result</code> entries. This correctly handles:</p>
<ul>
<li><code>tc tc tr tr</code> → one batch (parallel tool calls in a single API response)</li>
<li><code>tc tr tc tr</code> → two batches (sequential single-tool API responses)</li>
<li><code>tc tc tr tr tc tr</code> → two batches (parallel then sequential)</li>
</ul>
<p>Backward compat: old interleaved entries without tool_call_id are paired by
position with synthetic IDs derived from the tool_call entry’s own ID.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.messages_to_entries" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#859-931">Source</a><h4 class="code-header">fn <a href="#method.messages_to_entries" class="fn">messages_to_entries</a>(
    &amp;self,
    messages: &amp;[<a class="enum" href="https://docs.rs/serde_json/1.0.149/serde_json/value/enum.Value.html" title="enum serde_json::value::Value">Value</a>],
    context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>,
) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.93.1/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="struct" href="../context/struct.TranscriptEntry.html" title="struct chibi_core::context::TranscriptEntry">TranscriptEntry</a>&gt;</h4></section></summary><div class="docblock"><p>Convert JSON messages back to transcript entries (for save_context).</p>
<p>Decomposes JSON values:</p>
<ul>
<li>role “user” or “assistant” (no tool_calls) → ENTRY_TYPE_MESSAGE</li>
<li>role “assistant” with tool_calls → N ENTRY_TYPE_TOOL_CALL entries</li>
<li>role “tool” → ENTRY_TYPE_TOOL_RESULT entry</li>
<li>role “system” → skipped</li>
</ul>
</div></details><section id="method.save_context" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#933-973">Source</a><h4 class="code-header">pub fn <a href="#method.save_context" class="fn">save_context</a>(&amp;self, context: &amp;<a class="struct" href="../context/struct.Context.html" title="struct chibi_core::context::Context">Context</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.unit.html">()</a>&gt;</h4></section><details class="toggle method-toggle" open><summary><section id="method.append_to_transcript" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#979-1014">Source</a><h4 class="code-header">pub fn <a href="#method.append_to_transcript" class="fn">append_to_transcript</a>(
    &amp;self,
    context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>,
    entry: &amp;<a class="struct" href="../context/struct.TranscriptEntry.html" title="struct chibi_core::context::TranscriptEntry">TranscriptEntry</a>,
) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Append a single entry to transcript (the authoritative log, using partitioned storage)</p>
<p>Uses cached active state when available to avoid repeated file scans.
The cache is updated after each operation and invalidated on context clear/compaction.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.append_to_transcript_and_context" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#1018-1028">Source</a><h4 class="code-header">pub fn <a href="#method.append_to_transcript_and_context" class="fn">append_to_transcript_and_context</a>(
    &amp;self,
    context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>,
    entry: &amp;<a class="struct" href="../context/struct.TranscriptEntry.html" title="struct chibi_core::context::TranscriptEntry">TranscriptEntry</a>,
) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Append an entry to both transcript.jsonl and context.jsonl (tandem write)
This is the primary method for recording new events during normal operation.</p>
</div></details><section id="method.calculate_token_count" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#1035-1042">Source</a><h4 class="code-header">pub fn <a href="#method.calculate_token_count" class="fn">calculate_token_count</a>(&amp;self, messages: &amp;[<a class="enum" href="https://docs.rs/serde_json/1.0.149/serde_json/value/enum.Value.html" title="enum serde_json::value::Value">Value</a>]) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.usize.html">usize</a></h4></section><section id="method.should_warn" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#1044-1055">Source</a><h4 class="code-header">pub fn <a href="#method.should_warn" class="fn">should_warn</a>(&amp;self, messages: &amp;[<a class="enum" href="https://docs.rs/serde_json/1.0.149/serde_json/value/enum.Value.html" title="enum serde_json::value::Value">Value</a>]) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.bool.html">bool</a></h4></section><section id="method.remaining_tokens" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#1057-1067">Source</a><h4 class="code-header">pub fn <a href="#method.remaining_tokens" class="fn">remaining_tokens</a>(&amp;self, messages: &amp;[<a class="enum" href="https://docs.rs/serde_json/1.0.149/serde_json/value/enum.Value.html" title="enum serde_json::value::Value">Value</a>]) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.usize.html">usize</a></h4></section><section id="method.should_auto_compact" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#1069-1080">Source</a><h4 class="code-header">pub fn <a href="#method.should_auto_compact" class="fn">should_auto_compact</a>(
    &amp;self,
    context: &amp;<a class="struct" href="../context/struct.Context.html" title="struct chibi_core::context::Context">Context</a>,
    resolved_config: &amp;<a class="struct" href="../config/struct.ResolvedConfig.html" title="struct chibi_core::config::ResolvedConfig">ResolvedConfig</a>,
) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.bool.html">bool</a></h4></section><details class="toggle method-toggle" open><summary><section id="method.read_jsonl_transcript" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#1083-1085">Source</a><h4 class="code-header">pub fn <a href="#method.read_jsonl_transcript" class="fn">read_jsonl_transcript</a>(
    &amp;self,
    context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>,
) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.1/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="struct" href="../context/struct.TranscriptEntry.html" title="struct chibi_core::context::TranscriptEntry">TranscriptEntry</a>&gt;&gt;</h4></section></summary><div class="docblock"><p>Read all entries from the context file (context.jsonl) - unified with transcript</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.finalize_compaction" class="method"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#1091-1100">Source</a><h4 class="code-header">pub fn <a href="#method.finalize_compaction" class="fn">finalize_compaction</a>(
    &amp;self,
    context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>,
    summary: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>,
) -&gt; <a class="type" href="https://doc.rust-lang.org/1.93.1/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Finalize a compaction operation by writing the anchor to transcript and marking dirty.
This is the common final step for all compaction operations (rolling, manual, by-name).</p>
</div></details></div></details></div><h2 id="trait-implementations" class="section-header">Trait Implementations<a href="#trait-implementations" class="anchor">§</a></h2><div id="trait-implementations-list"><details class="toggle implementors-toggle" open><summary><section id="impl-StatePaths-for-AppState" class="impl"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#56-60">Source</a><a href="#impl-StatePaths-for-AppState" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="trait.StatePaths.html" title="trait chibi_core::state::StatePaths">StatePaths</a> for <a class="struct" href="struct.AppState.html" title="struct chibi_core::state::AppState">AppState</a></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.contexts_dir" class="method trait-impl"><a class="src rightside" href="../../src/chibi_core/state/mod.rs.html#57-59">Source</a><a href="#method.contexts_dir" class="anchor">§</a><h4 class="code-header">fn <a href="trait.StatePaths.html#tymethod.contexts_dir" class="fn">contexts_dir</a>(&amp;self) -&gt; &amp;<a class="struct" href="https://doc.rust-lang.org/1.93.1/std/path/struct.PathBuf.html" title="struct std::path::PathBuf">PathBuf</a></h4></section></summary><div class='docblock'>Get the contexts directory root</div></details><details class="toggle method-toggle" open><summary><section id="method.context_dir" class="method trait-impl"><a class="src rightside" href="../../src/chibi_core/state/paths.rs.html#14-16">Source</a><a href="#method.context_dir" class="anchor">§</a><h4 class="code-header">fn <a href="trait.StatePaths.html#method.context_dir" class="fn">context_dir</a>(&amp;self, name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.93.1/std/path/struct.PathBuf.html" title="struct std::path::PathBuf">PathBuf</a></h4></section></summary><div class='docblock'>Path to a context’s directory</div></details><details class="toggle method-toggle" open><summary><section id="method.context_file" class="method trait-impl"><a class="src rightside" href="../../src/chibi_core/state/paths.rs.html#19-21">Source</a><a href="#method.context_file" class="anchor">§</a><h4 class="code-header">fn <a href="trait.StatePaths.html#method.context_file" class="fn">context_file</a>(&amp;self, name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.93.1/std/path/struct.PathBuf.html" title="struct std::path::PathBuf">PathBuf</a></h4></section></summary><div class='docblock'>Path to context.jsonl file</div></details><details class="toggle method-toggle" open><summary><section id="method.context_file_old" class="method trait-impl"><a class="src rightside" href="../../src/chibi_core/state/paths.rs.html#24-26">Source</a><a href="#method.context_file_old" class="anchor">§</a><h4 class="code-header">fn <a href="trait.StatePaths.html#method.context_file_old" class="fn">context_file_old</a>(&amp;self, name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.93.1/std/path/struct.PathBuf.html" title="struct std::path::PathBuf">PathBuf</a></h4></section></summary><div class='docblock'>Path to the old context.json format (for migration)</div></details><details class="toggle method-toggle" open><summary><section id="method.context_meta_file" class="method trait-impl"><a class="src rightside" href="../../src/chibi_core/state/paths.rs.html#29-31">Source</a><a href="#method.context_meta_file" class="anchor">§</a><h4 class="code-header">fn <a href="trait.StatePaths.html#method.context_meta_file" class="fn">context_meta_file</a>(&amp;self, name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.93.1/std/path/struct.PathBuf.html" title="struct std::path::PathBuf">PathBuf</a></h4></section></summary><div class='docblock'>Path to context metadata file</div></details><details class="toggle method-toggle" open><summary><section id="method.transcript_jsonl_file" class="method trait-impl"><a class="src rightside" href="../../src/chibi_core/state/paths.rs.html#34-36">Source</a><a href="#method.transcript_jsonl_file" class="anchor">§</a><h4 class="code-header">fn <a href="trait.StatePaths.html#method.transcript_jsonl_file" class="fn">transcript_jsonl_file</a>(&amp;self, name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.93.1/std/path/struct.PathBuf.html" title="struct std::path::PathBuf">PathBuf</a></h4></section></summary><div class='docblock'>Path to JSONL transcript (transcript.jsonl) - legacy location</div></details><details class="toggle method-toggle" open><summary><section id="method.transcript_dir" class="method trait-impl"><a class="src rightside" href="../../src/chibi_core/state/paths.rs.html#39-41">Source</a><a href="#method.transcript_dir" class="anchor">§</a><h4 class="code-header">fn <a href="trait.StatePaths.html#method.transcript_dir" class="fn">transcript_dir</a>(&amp;self, name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.93.1/std/path/struct.PathBuf.html" title="struct std::path::PathBuf">PathBuf</a></h4></section></summary><div class='docblock'>Path to partitioned transcript directory</div></details><details class="toggle method-toggle" open><summary><section id="method.dirty_marker_file" class="method trait-impl"><a class="src rightside" href="../../src/chibi_core/state/paths.rs.html#46-48">Source</a><a href="#method.dirty_marker_file" class="anchor">§</a><h4 class="code-header">fn <a href="trait.StatePaths.html#method.dirty_marker_file" class="fn">dirty_marker_file</a>(&amp;self, name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.93.1/std/path/struct.PathBuf.html" title="struct std::path::PathBuf">PathBuf</a></h4></section></summary><div class='docblock'>Path to dirty context marker file (.dirty)
A “dirty” context has a stale prefix (anchor + system prompt) that needs rebuilding.
A “clean” context has a valid prefix that caches well.</div></details><details class="toggle method-toggle" open><summary><section id="method.summary_file" class="method trait-impl"><a class="src rightside" href="../../src/chibi_core/state/paths.rs.html#51-53">Source</a><a href="#method.summary_file" class="anchor">§</a><h4 class="code-header">fn <a href="trait.StatePaths.html#method.summary_file" class="fn">summary_file</a>(&amp;self, name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.93.1/std/path/struct.PathBuf.html" title="struct std::path::PathBuf">PathBuf</a></h4></section></summary><div class='docblock'>Path to summary file</div></details><details class="toggle method-toggle" open><summary><section id="method.context_prompt_file" class="method trait-impl"><a class="src rightside" href="../../src/chibi_core/state/paths.rs.html#56-58">Source</a><a href="#method.context_prompt_file" class="anchor">§</a><h4 class="code-header">fn <a href="trait.StatePaths.html#method.context_prompt_file" class="fn">context_prompt_file</a>(&amp;self, context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.93.1/std/path/struct.PathBuf.html" title="struct std::path::PathBuf">PathBuf</a></h4></section></summary><div class='docblock'>Get the path to a context’s system prompt file</div></details><details class="toggle method-toggle" open><summary><section id="method.todos_file" class="method trait-impl"><a class="src rightside" href="../../src/chibi_core/state/paths.rs.html#61-63">Source</a><a href="#method.todos_file" class="anchor">§</a><h4 class="code-header">fn <a href="trait.StatePaths.html#method.todos_file" class="fn">todos_file</a>(&amp;self, context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.93.1/std/path/struct.PathBuf.html" title="struct std::path::PathBuf">PathBuf</a></h4></section></summary><div class='docblock'>Get the path to a context’s todos file</div></details><details class="toggle method-toggle" open><summary><section id="method.goals_file" class="method trait-impl"><a class="src rightside" href="../../src/chibi_core/state/paths.rs.html#66-68">Source</a><a href="#method.goals_file" class="anchor">§</a><h4 class="code-header">fn <a href="trait.StatePaths.html#method.goals_file" class="fn">goals_file</a>(&amp;self, context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.93.1/std/path/struct.PathBuf.html" title="struct std::path::PathBuf">PathBuf</a></h4></section></summary><div class='docblock'>Get the path to a context’s goals file</div></details><details class="toggle method-toggle" open><summary><section id="method.local_config_file" class="method trait-impl"><a class="src rightside" href="../../src/chibi_core/state/paths.rs.html#71-73">Source</a><a href="#method.local_config_file" class="anchor">§</a><h4 class="code-header">fn <a href="trait.StatePaths.html#method.local_config_file" class="fn">local_config_file</a>(&amp;self, context_name: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.str.html">str</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.93.1/std/path/struct.PathBuf.html" title="struct std::path::PathBuf">PathBuf</a></h4></section></summary><div class='docblock'>Get the path to a context’s local config file</div></details></div></details></div><h2 id="synthetic-implementations" class="section-header">Auto Trait Implementations<a href="#synthetic-implementations" class="anchor">§</a></h2><div id="synthetic-implementations-list"><section id="impl-Freeze-for-AppState" class="impl"><a href="#impl-Freeze-for-AppState" class="anchor">§</a><h3 class="code-header">impl !<a class="trait" href="https://doc.rust-lang.org/1.93.1/core/marker/trait.Freeze.html" title="trait core::marker::Freeze">Freeze</a> for <a class="struct" href="struct.AppState.html" title="struct chibi_core::state::AppState">AppState</a></h3></section><section id="impl-RefUnwindSafe-for-AppState" class="impl"><a href="#impl-RefUnwindSafe-for-AppState" class="anchor">§</a><h3 class="code-header">impl !<a class="trait" href="https://doc.rust-lang.org/1.93.1/core/panic/unwind_safe/trait.RefUnwindSafe.html" title="trait core::panic::unwind_safe::RefUnwindSafe">RefUnwindSafe</a> for <a class="struct" href="struct.AppState.html" title="struct chibi_core::state::AppState">AppState</a></h3></section><section id="impl-Send-for-AppState" class="impl"><a href="#impl-Send-for-AppState" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="https://doc.rust-lang.org/1.93.1/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> for <a class="struct" href="struct.AppState.html" title="struct chibi_core::state::AppState">AppState</a></h3></section><section id="impl-Sync-for-AppState" class="impl"><a href="#impl-Sync-for-AppState" class="anchor">§</a><h3 class="code-header">impl !<a class="trait" href="https://doc.rust-lang.org/1.93.1/core/marker/trait.Sync.html" title="trait core::marker::Sync">Sync</a> for <a class="struct" href="struct.AppState.html" title="struct chibi_core::state::AppState">AppState</a></h3></section><section id="impl-Unpin-for-AppState" class="impl"><a href="#impl-Unpin-for-AppState" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="https://doc.rust-lang.org/1.93.1/core/marker/trait.Unpin.html" title="trait core::marker::Unpin">Unpin</a> for <a class="struct" href="struct.AppState.html" title="struct chibi_core::state::AppState">AppState</a></h3></section><section id="impl-UnwindSafe-for-AppState" class="impl"><a href="#impl-UnwindSafe-for-AppState" class="anchor">§</a><h3 class="code-header">impl !<a class="trait" href="https://doc.rust-lang.org/1.93.1/core/panic/unwind_safe/trait.UnwindSafe.html" title="trait core::panic::unwind_safe::UnwindSafe">UnwindSafe</a> for <a class="struct" href="struct.AppState.html" title="struct chibi_core::state::AppState">AppState</a></h3></section></div><h2 id="blanket-implementations" class="section-header">Blanket Implementations<a href="#blanket-implementations" class="anchor">§</a></h2><div id="blanket-implementations-list"><details class="toggle implementors-toggle"><summary><section id="impl-Any-for-T" class="impl"><a class="src rightside" href="https://doc.rust-lang.org/1.93.1/src/core/any.rs.html#138">Source</a><a href="#impl-Any-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T&gt; <a class="trait" href="https://doc.rust-lang.org/1.93.1/core/any/trait.Any.html" title="trait core::any::Any">Any</a> for T<div class="where">where
    T: 'static + ?<a class="trait" href="https://doc.rust-lang.org/1.93.1/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,</div></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.type_id" class="method trait-impl"><a class="src rightside" href="https://doc.rust-lang.org/1.93.1/src/core/any.rs.html#139">Source</a><a href="#method.type_id" class="anchor">§</a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/1.93.1/core/any/trait.Any.html#tymethod.type_id" class="fn">type_id</a>(&amp;self) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.93.1/core/any/struct.TypeId.html" title="struct core::any::TypeId">TypeId</a></h4></section></summary><div class='docblock'>Gets the <code>TypeId</code> of <code>self</code>. <a href="https://doc.rust-lang.org/1.93.1/core/any/trait.Any.html#tymethod.type_id">Read more</a></div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-Borrow%3CT%3E-for-T" class="impl"><a class="src rightside" href="https://doc.rust-lang.org/1.93.1/src/core/borrow.rs.html#212">Source</a><a href="#impl-Borrow%3CT%3E-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T&gt; <a class="trait" href="https://doc.rust-lang.org/1.93.1/core/borrow/trait.Borrow.html" title="trait core::borrow::Borrow">Borrow</a>&lt;T&gt; for T<div class="where">where
    T: ?<a class="trait" href="https://doc.rust-lang.org/1.93.1/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,</div></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.borrow" class="method trait-impl"><a class="src rightside" href="https://doc.rust-lang.org/1.93.1/src/core/borrow.rs.html#214">Source</a><a href="#method.borrow" class="anchor">§</a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/1.93.1/core/borrow/trait.Borrow.html#tymethod.borrow" class="fn">borrow</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.reference.html">&amp;T</a></h4></section></summary><div class='docblock'>Immutably borrows from an owned value. <a href="https://doc.rust-lang.org/1.93.1/core/borrow/trait.Borrow.html#tymethod.borrow">Read more</a></div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-BorrowMut%3CT%3E-for-T" class="impl"><a class="src rightside" href="https://doc.rust-lang.org/1.93.1/src/core/borrow.rs.html#221">Source</a><a href="#impl-BorrowMut%3CT%3E-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T&gt; <a class="trait" href="https://doc.rust-lang.org/1.93.1/core/borrow/trait.BorrowMut.html" title="trait core::borrow::BorrowMut">BorrowMut</a>&lt;T&gt; for T<div class="where">where
    T: ?<a class="trait" href="https://doc.rust-lang.org/1.93.1/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,</div></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.borrow_mut" class="method trait-impl"><a class="src rightside" href="https://doc.rust-lang.org/1.93.1/src/core/borrow.rs.html#222">Source</a><a href="#method.borrow_mut" class="anchor">§</a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/1.93.1/core/borrow/trait.BorrowMut.html#tymethod.borrow_mut" class="fn">borrow_mut</a>(&amp;mut self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.reference.html">&amp;mut T</a></h4></section></summary><div class='docblock'>Mutably borrows from an owned value. <a href="https://doc.rust-lang.org/1.93.1/core/borrow/trait.BorrowMut.html#tymethod.borrow_mut">Read more</a></div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-From%3CT%3E-for-T" class="impl"><a class="src rightside" href="https://doc.rust-lang.org/1.93.1/src/core/convert/mod.rs.html#785">Source</a><a href="#impl-From%3CT%3E-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T&gt; <a class="trait" href="https://doc.rust-lang.org/1.93.1/core/convert/trait.From.html" title="trait core::convert::From">From</a>&lt;T&gt; for T</h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.from" class="method trait-impl"><a class="src rightside" href="https://doc.rust-lang.org/1.93.1/src/core/convert/mod.rs.html#788">Source</a><a href="#method.from" class="anchor">§</a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/1.93.1/core/convert/trait.From.html#tymethod.from" class="fn">from</a>(t: T) -&gt; T</h4></section></summary><div class="docblock"><p>Returns the argument unchanged.</p>
</div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-Instrument-for-T" class="impl"><a href="#impl-Instrument-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T&gt; Instrument for T</h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.instrument" class="method trait-impl"><a href="#method.instrument" class="anchor">§</a><h4 class="code-header">fn <a class="fn">instrument</a>(self, span: Span) -&gt; Instrumented&lt;Self&gt;</h4></section></summary><div class='docblock'>Instruments this type with the provided [<code>Span</code>], returning an
<code>Instrumented</code> wrapper. <a>Read more</a></div></details><details class="toggle method-toggle" open><summary><section id="method.in_current_span" class="method trait-impl"><a href="#method.in_current_span" class="anchor">§</a><h4 class="code-header">fn <a class="fn">in_current_span</a>(self) -&gt; Instrumented&lt;Self&gt;</h4></section></summary><div class='docblock'>Instruments this type with the <a href="super::Span::current()">current</a> <a href="crate::Span"><code>Span</code></a>, returning an
<code>Instrumented</code> wrapper. <a>Read more</a></div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-Into%3CU%3E-for-T" class="impl"><a class="src rightside" href="https://doc.rust-lang.org/1.93.1/src/core/convert/mod.rs.html#767-769">Source</a><a href="#impl-Into%3CU%3E-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T, U&gt; <a class="trait" href="https://doc.rust-lang.org/1.93.1/core/convert/trait.Into.html" title="trait core::convert::Into">Into</a>&lt;U&gt; for T<div class="where">where
    U: <a class="trait" href="https://doc.rust-lang.org/1.93.1/core/convert/trait.From.html" title="trait core::convert::From">From</a>&lt;T&gt;,</div></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.into" class="method trait-impl"><a class="src rightside" href="https://doc.rust-lang.org/1.93.1/src/core/convert/mod.rs.html#777">Source</a><a href="#method.into" class="anchor">§</a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/1.93.1/core/convert/trait.Into.html#tymethod.into" class="fn">into</a>(self) -&gt; U</h4></section></summary><div class="docblock"><p>Calls <code>U::from(self)</code>.</p>
<p>That is, this conversion is whatever the implementation of
<code><a href="https://doc.rust-lang.org/1.93.1/core/convert/trait.From.html" title="trait core::convert::From">From</a>&lt;T&gt; for U</code> chooses to do.</p>
</div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-IntoEither-for-T" class="impl"><a class="src rightside" href="https://docs.rs/either/1/src/either/into_either.rs.html#64">Source</a><a href="#impl-IntoEither-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T&gt; <a class="trait" href="https://docs.rs/either/1/either/into_either/trait.IntoEither.html" title="trait either::into_either::IntoEither">IntoEither</a> for T</h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.into_either" class="method trait-impl"><a class="src rightside" href="https://docs.rs/either/1/src/either/into_either.rs.html#29">Source</a><a href="#method.into_either" class="anchor">§</a><h4 class="code-header">fn <a href="https://docs.rs/either/1/either/into_either/trait.IntoEither.html#method.into_either" class="fn">into_either</a>(self, into_left: <a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.bool.html">bool</a>) -&gt; <a class="enum" href="https://docs.rs/either/1/either/enum.Either.html" title="enum either::Either">Either</a>&lt;Self, Self&gt;</h4></section></summary><div class='docblock'>Converts <code>self</code> into a <a href="https://docs.rs/either/1/either/enum.Either.html#variant.Left" title="variant either::Either::Left"><code>Left</code></a> variant of <a href="https://docs.rs/either/1/either/enum.Either.html" title="enum either::Either"><code>Either&lt;Self, Self&gt;</code></a>
if <code>into_left</code> is <code>true</code>.
Converts <code>self</code> into a <a href="https://docs.rs/either/1/either/enum.Either.html#variant.Right" title="variant either::Either::Right"><code>Right</code></a> variant of <a href="https://docs.rs/either/1/either/enum.Either.html" title="enum either::Either"><code>Either&lt;Self, Self&gt;</code></a>
otherwise. <a href="https://docs.rs/either/1/either/into_either/trait.IntoEither.html#method.into_either">Read more</a></div></details><details class="toggle method-toggle" open><summary><section id="method.into_either_with" class="method trait-impl"><a class="src rightside" href="https://docs.rs/either/1/src/either/into_either.rs.html#55-57">Source</a><a href="#method.into_either_with" class="anchor">§</a><h4 class="code-header">fn <a href="https://docs.rs/either/1/either/into_either/trait.IntoEither.html#method.into_either_with" class="fn">into_either_with</a>&lt;F&gt;(self, into_left: F) -&gt; <a class="enum" href="https://docs.rs/either/1/either/enum.Either.html" title="enum either::Either">Either</a>&lt;Self, Self&gt;<div class="where">where
    F: <a class="trait" href="https://doc.rust-lang.org/1.93.1/core/ops/function/trait.FnOnce.html" title="trait core::ops::function::FnOnce">FnOnce</a>(&amp;Self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.bool.html">bool</a>,</div></h4></section></summary><div class='docblock'>Converts <code>self</code> into a <a href="https://docs.rs/either/1/either/enum.Either.html#variant.Left" title="variant either::Either::Left"><code>Left</code></a> variant of <a href="https://docs.rs/either/1/either/enum.Either.html" title="enum either::Either"><code>Either&lt;Self, Self&gt;</code></a>
if <code>into_left(&amp;self)</code> returns <code>true</code>.
Converts <code>self</code> into a <a href="https://docs.rs/either/1/either/enum.Either.html#variant.Right" title="variant either::Either::Right"><code>Right</code></a> variant of <a href="https://docs.rs/either/1/either/enum.Either.html" title="enum either::Either"><code>Either&lt;Self, Self&gt;</code></a>
otherwise. <a href="https://docs.rs/either/1/either/into_either/trait.IntoEither.html#method.into_either_with">Read more</a></div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-IntoShared%3CShared%3E-for-Unshared" class="impl"><a href="#impl-IntoShared%3CShared%3E-for-Unshared" class="anchor">§</a><h3 class="code-header">impl&lt;Unshared, Shared&gt; IntoShared&lt;Shared&gt; for Unshared<div class="where">where
    Shared: FromUnshared&lt;Unshared&gt;,</div></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.into_shared" class="method trait-impl"><a href="#method.into_shared" class="anchor">§</a><h4 class="code-header">fn <a class="fn">into_shared</a>(self) -&gt; Shared</h4></section></summary><div class='docblock'>Creates a shared type from an unshared type.</div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-Pointable-for-T" class="impl"><a href="#impl-Pointable-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T&gt; Pointable for T</h3></section></summary><div class="impl-items"><details class="toggle" open><summary><section id="associatedconstant.ALIGN" class="associatedconstant trait-impl"><a href="#associatedconstant.ALIGN" class="anchor">§</a><h4 class="code-header">const <a class="constant">ALIGN</a>: <a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.usize.html">usize</a></h4></section></summary><div class='docblock'>The alignment of pointer.</div></details><details class="toggle" open><summary><section id="associatedtype.Init" class="associatedtype trait-impl"><a href="#associatedtype.Init" class="anchor">§</a><h4 class="code-header">type <a class="associatedtype">Init</a> = T</h4></section></summary><div class='docblock'>The type for initializers.</div></details><details class="toggle method-toggle" open><summary><section id="method.init" class="method trait-impl"><a href="#method.init" class="anchor">§</a><h4 class="code-header">unsafe fn <a class="fn">init</a>(init: &lt;T as Pointable&gt;::Init) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.usize.html">usize</a></h4></section></summary><div class='docblock'>Initializes a with the given initializer. <a>Read more</a></div></details><details class="toggle method-toggle" open><summary><section id="method.deref" class="method trait-impl"><a href="#method.deref" class="anchor">§</a><h4 class="code-header">unsafe fn <a class="fn">deref</a>&lt;'a&gt;(ptr: <a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.usize.html">usize</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.reference.html">&amp;'a T</a></h4></section></summary><div class='docblock'>Dereferences the given pointer. <a>Read more</a></div></details><details class="toggle method-toggle" open><summary><section id="method.deref_mut" class="method trait-impl"><a href="#method.deref_mut" class="anchor">§</a><h4 class="code-header">unsafe fn <a class="fn">deref_mut</a>&lt;'a&gt;(ptr: <a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.usize.html">usize</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.reference.html">&amp;'a mut T</a></h4></section></summary><div class='docblock'>Mutably dereferences the given pointer. <a>Read more</a></div></details><details class="toggle method-toggle" open><summary><section id="method.drop" class="method trait-impl"><a href="#method.drop" class="anchor">§</a><h4 class="code-header">unsafe fn <a class="fn">drop</a>(ptr: <a class="primitive" href="https://doc.rust-lang.org/1.93.1/std/primitive.usize.html">usize</a>)</h4></section></summary><div class='docblock'>Drops the object pointed to by the given pointer. <a>Read more</a></div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-PolicyExt-for-T" class="impl"><a href="#impl-PolicyExt-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T&gt; PolicyExt for T<div class="where">where
    T: ?<a class="trait" href="https://doc.rust-lang.org/1.93.1/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,</div></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.and" class="method trait-impl"><a href="#method.and" class="anchor">§</a><h4 class="code-header">fn <a class="fn">and</a>&lt;P, B, E&gt;(self, other: P) -&gt; And&lt;T, P&gt;<div class="where">where
    T: Policy&lt;B, E&gt;,
    P: Policy&lt;B, E&gt;,</div></h4></section></summary><div class='docblock'>Create a new <code>Policy</code> that returns [<code>Action::Follow</code>] only if <code>self</code> and <code>other</code> return
<code>Action::Follow</code>. <a>Read more</a></div></details><details class="toggle method-toggle" open><summary><section id="method.or" class="method trait-impl"><a href="#method.or" class="anchor">§</a><h4 class="code-header">fn <a class="fn">or</a>&lt;P, B, E&gt;(self, other: P) -&gt; Or&lt;T, P&gt;<div class="where">where
    T: Policy&lt;B, E&gt;,
    P: Policy&lt;B, E&gt;,</div></h4></section></summary><div class='docblock'>Create a new <code>Policy</code> that returns [<code>Action::Follow</code>] if either <code>self</code> or <code>other</code> returns
<code>Action::Follow</code>. <a>Read more</a></div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-Same-for-T" class="impl"><a class="src rightside" href="https://docs.rs/typenum/1.19.0/src/typenum/type_operators.rs.html#34">Source</a><a href="#impl-Same-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T&gt; <a class="trait" href="https://docs.rs/typenum/1.19.0/typenum/type_operators/trait.Same.html" title="trait typenum::type_operators::Same">Same</a> for T</h3></section></summary><div class="impl-items"><details class="toggle" open><summary><section id="associatedtype.Output" class="associatedtype trait-impl"><a class="src rightside" href="https://docs.rs/typenum/1.19.0/src/typenum/type_operators.rs.html#35">Source</a><a href="#associatedtype.Output" class="anchor">§</a><h4 class="code-header">type <a href="https://docs.rs/typenum/1.19.0/typenum/type_operators/trait.Same.html#associatedtype.Output" class="associatedtype">Output</a> = T</h4></section></summary><div class='docblock'>Should always be <code>Self</code></div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-TryFrom%3CU%3E-for-T" class="impl"><a class="src rightside" href="https://doc.rust-lang.org/1.93.1/src/core/convert/mod.rs.html#827-829">Source</a><a href="#impl-TryFrom%3CU%3E-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T, U&gt; <a class="trait" href="https://doc.rust-lang.org/1.93.1/core/convert/trait.TryFrom.html" title="trait core::convert::TryFrom">TryFrom</a>&lt;U&gt; for T<div class="where">where
    U: <a class="trait" href="https://doc.rust-lang.org/1.93.1/core/convert/trait.Into.html" title="trait core::convert::Into">Into</a>&lt;T&gt;,</div></h3></section></summary><div class="impl-items"><details class="toggle" open><summary><section id="associatedtype.Error-1" class="associatedtype trait-impl"><a class="src rightside" href="https://doc.rust-lang.org/1.93.1/src/core/convert/mod.rs.html#831">Source</a><a href="#associatedtype.Error-1" class="anchor">§</a><h4 class="code-header">type <a href="https://doc.rust-lang.org/1.93.1/core/convert/trait.TryFrom.html#associatedtype.Error" class="associatedtype">Error</a> = <a class="enum" href="https://doc.rust-lang.org/1.93.1/core/convert/enum.Infallible.html" title="enum core::convert::Infallible">Infallible</a></h4></section></summary><div class='docblock'>The type returned in the event of a conversion error.</div></details><details class="toggle method-toggle" open><summary><section id="method.try_from" class="method trait-impl"><a class="src rightside" href="https://doc.rust-lang.org/1.93.1/src/core/convert/mod.rs.html#834">Source</a><a href="#method.try_from" class="anchor">§</a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/1.93.1/core/convert/trait.TryFrom.html#tymethod.try_from" class="fn">try_from</a>(value: U) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.93.1/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;T, &lt;T as <a class="trait" href="https://doc.rust-lang.org/1.93.1/core/convert/trait.TryFrom.html" title="trait core::convert::TryFrom">TryFrom</a>&lt;U&gt;&gt;::<a class="associatedtype" href="https://doc.rust-lang.org/1.93.1/core/convert/trait.TryFrom.html#associatedtype.Error" title="type core::convert::TryFrom::Error">Error</a>&gt;</h4></section></summary><div class='docblock'>Performs the conversion.</div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-TryInto%3CU%3E-for-T" class="impl"><a class="src rightside" href="https://doc.rust-lang.org/1.93.1/src/core/convert/mod.rs.html#811-813">Source</a><a href="#impl-TryInto%3CU%3E-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T, U&gt; <a class="trait" href="https://doc.rust-lang.org/1.93.1/core/convert/trait.TryInto.html" title="trait core::convert::TryInto">TryInto</a>&lt;U&gt; for T<div class="where">where
    U: <a class="trait" href="https://doc.rust-lang.org/1.93.1/core/convert/trait.TryFrom.html" title="trait core::convert::TryFrom">TryFrom</a>&lt;T&gt;,</div></h3></section></summary><div class="impl-items"><details class="toggle" open><summary><section id="associatedtype.Error" class="associatedtype trait-impl"><a class="src rightside" href="https://doc.rust-lang.org/1.93.1/src/core/convert/mod.rs.html#815">Source</a><a href="#associatedtype.Error" class="anchor">§</a><h4 class="code-header">type <a href="https://doc.rust-lang.org/1.93.1/core/convert/trait.TryInto.html#associatedtype.Error" class="associatedtype">Error</a> = &lt;U as <a class="trait" href="https://doc.rust-lang.org/1.93.1/core/convert/trait.TryFrom.html" title="trait core::convert::TryFrom">TryFrom</a>&lt;T&gt;&gt;::<a class="associatedtype" href="https://doc.rust-lang.org/1.93.1/core/convert/trait.TryFrom.html#associatedtype.Error" title="type core::convert::TryFrom::Error">Error</a></h4></section></summary><div class='docblock'>The type returned in the event of a conversion error.</div></details><details class="toggle method-toggle" open><summary><section id="method.try_into" class="method trait-impl"><a class="src rightside" href="https://doc.rust-lang.org/1.93.1/src/core/convert/mod.rs.html#818">Source</a><a href="#method.try_into" class="anchor">§</a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/1.93.1/core/convert/trait.TryInto.html#tymethod.try_into" class="fn">try_into</a>(self) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.93.1/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;U, &lt;U as <a class="trait" href="https://doc.rust-lang.org/1.93.1/core/convert/trait.TryFrom.html" title="trait core::convert::TryFrom">TryFrom</a>&lt;T&gt;&gt;::<a class="associatedtype" href="https://doc.rust-lang.org/1.93.1/core/convert/trait.TryFrom.html#associatedtype.Error" title="type core::convert::TryFrom::Error">Error</a>&gt;</h4></section></summary><div class='docblock'>Performs the conversion.</div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-VZip%3CV%3E-for-T" class="impl"><a href="#impl-VZip%3CV%3E-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;V, T&gt; VZip&lt;V&gt; for T<div class="where">where
    V: MultiLane&lt;T&gt;,</div></h3></section></summary><div class="impl-items"><section id="method.vzip" class="method trait-impl"><a href="#method.vzip" class="anchor">§</a><h4 class="code-header">fn <a class="fn">vzip</a>(self) -&gt; V</h4></section></div></details><details class="toggle implementors-toggle"><summary><section id="impl-WithSubscriber-for-T" class="impl"><a href="#impl-WithSubscriber-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T&gt; WithSubscriber for T</h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.with_subscriber" class="method trait-impl"><a href="#method.with_subscriber" class="anchor">§</a><h4 class="code-header">fn <a class="fn">with_subscriber</a>&lt;S&gt;(self, subscriber: S) -&gt; WithDispatch&lt;Self&gt;<div class="where">where
    S: <a class="trait" href="https://doc.rust-lang.org/1.93.1/core/convert/trait.Into.html" title="trait core::convert::Into">Into</a>&lt;Dispatch&gt;,</div></h4></section></summary><div class='docblock'>Attaches the provided <a href="super::Subscriber"><code>Subscriber</code></a> to this type, returning a
[<code>WithDispatch</code>] wrapper. <a>Read more</a></div></details><details class="toggle method-toggle" open><summary><section id="method.with_current_subscriber" class="method trait-impl"><a href="#method.with_current_subscriber" class="anchor">§</a><h4 class="code-header">fn <a class="fn">with_current_subscriber</a>(self) -&gt; WithDispatch&lt;Self&gt;</h4></section></summary><div class='docblock'>Attaches the current <a href="dispatcher#setting-the-default-subscriber">default</a> <a href="super::Subscriber"><code>Subscriber</code></a> to this type, returning a
[<code>WithDispatch</code>] wrapper. <a>Read more</a></div></details></div></details></div></section></div></main></body></html>